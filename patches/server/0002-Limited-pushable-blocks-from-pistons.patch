From b20a90df5def74946eb114a761f7d7da0d74a477 Mon Sep 17 00:00:00 2001
From: JOO200 <github@joo200.de>
Date: Sat, 7 Mar 2020 22:53:11 +0100
Subject: [PATCH] Limited pushable blocks from pistons

Optimized paper config option
---
 src/main/java/com/destroystokyo/paper/PaperConfig.java | 5 +++++
 src/main/java/net/minecraft/server/Block.java          | 4 ++++
 2 files changed, 9 insertions(+)

diff --git a/src/main/java/com/destroystokyo/paper/PaperConfig.java b/src/main/java/com/destroystokyo/paper/PaperConfig.java
index f0284e81d..0a75527cf 100644
--- a/src/main/java/com/destroystokyo/paper/PaperConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperConfig.java
@@ -442,4 +442,9 @@ public class PaperConfig {
         consoleHasAllPermissions = getBoolean("settings.console-has-all-permissions", consoleHasAllPermissions);
     }
 
+
+    public static List<String> blockedPistonBlocks = java.util.Collections.emptyList();
+    private static void blockedPistonBlocks() {
+        blockedPistonBlocks = config.getStringList("blockedPistonMaterials");
+    }
 }
diff --git a/src/main/java/net/minecraft/server/Block.java b/src/main/java/net/minecraft/server/Block.java
index d051a54aa..f776df930 100644
--- a/src/main/java/net/minecraft/server/Block.java
+++ b/src/main/java/net/minecraft/server/Block.java
@@ -603,6 +603,10 @@ public class Block implements IMaterial {
 
     @Deprecated
     public EnumPistonReaction getPushReaction(IBlockData iblockdata) {
+        // TerraPaper -- start block materials
+        if(com.destroystokyo.paper.PaperConfig.blockedPistonBlocks.contains(k())) return EnumPistonReaction.BLOCK;
+        // TerraPaper -- end
+
         return !blockData.isDestroyable() ? EnumPistonReaction.BLOCK : this.material.getPushReaction(); // Paper
     }
 
-- 
2.24.1.windows.2


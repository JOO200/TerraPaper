From 518f763d35540db361363d72cc6b77c6dca8a7ce Mon Sep 17 00:00:00 2001
From: JOO200 <github@joo200.de>
Date: Sat, 7 Mar 2020 22:53:11 +0100
Subject: [PATCH] Limited pushable blocks from pistons

Optimized paper config option
---
 src/main/java/com/destroystokyo/paper/PaperConfig.java | 6 ++++++
 src/main/java/net/minecraft/server/Block.java          | 4 ++++
 2 files changed, 10 insertions(+)

diff --git a/src/main/java/com/destroystokyo/paper/PaperConfig.java b/src/main/java/com/destroystokyo/paper/PaperConfig.java
index 8444819f07..96362217a6 100644
--- a/src/main/java/com/destroystokyo/paper/PaperConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperConfig.java
@@ -442,6 +442,12 @@ public class PaperConfig {
         consoleHasAllPermissions = getBoolean("settings.console-has-all-permissions", consoleHasAllPermissions);
     }
 
+
+    public static List<String> blockedPistonBlocks = java.util.Collections.emptyList();
+    private static void blockedPistonBlocks() {
+        blockedPistonBlocks = config.getStringList("blockedPistonMaterials");
+    }
+
     public static boolean allowPistonDuplication;
     private static void allowPistonDuplication() {
         allowPistonDuplication = getBoolean("settings.unsupported-settings.allow-piston-duplication", config.getBoolean("settings.unsupported-settings.allow-tnt-duplication", false));
diff --git a/src/main/java/net/minecraft/server/Block.java b/src/main/java/net/minecraft/server/Block.java
index 66244a9d0e..888f453399 100644
--- a/src/main/java/net/minecraft/server/Block.java
+++ b/src/main/java/net/minecraft/server/Block.java
@@ -604,6 +604,10 @@ public class Block implements IMaterial {
 
     @Deprecated
     public EnumPistonReaction getPushReaction(IBlockData iblockdata) {
+        // TerraPaper -- start block materials
+        if(com.destroystokyo.paper.PaperConfig.blockedPistonBlocks.contains(k())) return EnumPistonReaction.BLOCK;
+        // TerraPaper -- end
+
         return !blockData.isDestroyable() ? EnumPistonReaction.BLOCK : this.material.getPushReaction(); // Paper
     }
 
-- 
2.24.1.windows.2

